<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head><meta name="generator" content="Hexo 3.8.0">

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--Description-->

    

    
        <meta name="description" content="sysdig简介功能Sysdig 就是 system（系统）+dig（挖掘）的组合。Sysdig 是一个开源系统发掘工具，用于系统级别的勘察和排障，我们也可以把它看作一系列传统的 unix 系统工具的组合，主要包括：

strace：追踪某个进程产生和接收的系统调用。
tcpdump：分析网络数据，">
    

    <!--Author-->
    
        <meta name="author" content="nimitzlin">
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="sysdig简介">
    

    <!--Open Graph Description-->
    
        <meta property="og:description" content="sysdig简介功能Sysdig 就是 system（系统）+dig（挖掘）的组合。Sysdig 是一个开源系统发掘工具，用于系统级别的勘察和排障，我们也可以把它看作一系列传统的 unix 系统工具的组合，主要包括：

strace：追踪某个进程产生和接收的系统调用。
tcpdump：分析网络数据，">
    

    <!--Open Graph Site Name-->
        <meta property="og:site_name" content="nimitzlin blog">

    <!--Type page-->
    
        <meta property="og:type" content="article">
    

    <!--Page Cover-->
    
    
        <meta property="og:image" content="http://yoursite.comhttp://www.codeblocq.com/assets/projects/hexo-theme-clean-blog/img/home-bg.jpg">
    

        <meta name="twitter:card" content="summary_large_image">

    

    
        <meta name="twitter:image" content="http://yoursite.comhttp://www.codeblocq.com/assets/projects/hexo-theme-clean-blog/img/home-bg.jpg">
    

    <!-- Title -->
    
    <title>sysdig简介 - nimitzlin blog</title>

    <!-- Bootstrap Core CSS -->
    <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/style.css">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href="//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet" type="text/css">
    <link href="//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="//oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Gallery -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.css" type="text/css" rel="stylesheet">

    <!-- Google Analytics -->
    


    <!-- favicon -->
    

</head>


<body>

    <!-- Menu -->
    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">nimitzlin blog</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                
                    <li>
                        <a href="/">
                            
                                Home
                            
                        </a>
                    </li>
                
                    <li>
                        <a href="/archives">
                            
                                Archives
                            
                        </a>
                    </li>
                
                    <li>
                        <a href="/categories">
                            
                                Categories
                            
                        </a>
                    </li>
                
                    <li>
                        <a href="https://github.com/nimitzlin">
                            
                                <i class="fa fa-github fa-stack-2x"></i>
                            
                        </a>
                    </li>
                
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>

    <!-- Main Content -->
    <!-- Page Header -->
<!-- Set your background image for this header in your post front-matter: cover -->

<header class="intro-header" style="background-image: url('http://www.codeblocq.com/assets/projects/hexo-theme-clean-blog/img/home-bg.jpg')">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <h1>sysdig简介</h1>
                    
                    <span class="meta">
                        <!-- Date and Author -->
                        
                        
                            2019-05-13
                        
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

            <!-- Tags and categories -->
           
                <div class="col-lg-4 col-lg-offset-2 col-md-5 col-md-offset-1 post-tags">
                    
                        

<a href="/categories/linux/">linux</a>

                    
                </div>
                <div class="col-lg-4 col-md-5 post-categories">
                    
                </div>
            

            <!-- Gallery -->
            

            <!-- Post Main Content -->
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <h1 id="sysdig简介"><a href="#sysdig简介" class="headerlink" title="sysdig简介"></a>sysdig简介</h1><h2 id="功能"><a href="#功能" class="headerlink" title="功能"></a>功能</h2><p>Sysdig 就是 system（系统）+dig（挖掘）的组合。Sysdig 是一个开源系统发掘工具，用于系统级别的勘察和排障，我们也可以把它看作一系列传统的 unix 系统工具的组合，主要包括：</p>
<ul>
<li>strace：追踪某个进程产生和接收的系统调用。</li>
<li>tcpdump：分析网络数据，监控原始网络通信。</li>
<li>lsof： list opened files, 列出打开的文件。</li>
<li>top：监控系统性能工具。</li>
<li>htop ：交互式的进程浏览器，可以用来替换 top 命令。</li>
<li>iftop ：主要用来显示本机网络流量情况及各相互通信的流量集合。</li>
<li>lua：一个小巧的脚本语言。该语言的设计目的是为了嵌入应用程序中，从而为应用程序提供灵活的扩展和定制功能。</li>
</ul>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><ul>
<li>curl -s <a href="https://s3.amazonaws.com/download.draios.com/stable/install-sysdig|" target="_blank" rel="noopener">https://s3.amazonaws.com/download.draios.com/stable/install-sysdig|</a> sudo bash</li>
</ul>
<h2 id="基础应用"><a href="#基础应用" class="headerlink" title="基础应用"></a>基础应用</h2><ul>
<li><p><a href="https://sysdig.com/blog/linux-troubleshooting-cheatsheet/" target="_blank" rel="noopener">https://sysdig.com/blog/linux-troubleshooting-cheatsheet/</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">By default, sysdig prints the information for each captured event  on a single line, with the following format:</span><br><span class="line">*%evt.num %evt.time %evt.cpu %proc.name (%thread.tid) %evt.dir %evt.type %evt.info</span><br><span class="line">第一列是事件序号，它是自动增长的；</span><br><span class="line">第二列是发生事件的时间戳；</span><br><span class="line">第三列是 CPU ID；</span><br><span class="line">第四列是命令；</span><br><span class="line">第五列是线程 ID；</span><br><span class="line">第六列是事件方向，比如进入 ioctl 函数为 &gt;，离开为 &lt;；</span><br><span class="line">第七列是事件名称（比如 ioctl）；</span><br><span class="line">第八列是事件参数。</span><br></pre></td></tr></table></figure>
</li>
<li><p>sysdig</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">11546 14:19:40.970329079 0 sshd (987) &lt; clock_gettime </span><br><span class="line">11547 14:19:40.970329630 2 &lt;NA&gt; (136) &gt; switch next=4466(sysdig) pgft_maj=0 pgft_min=0 vm_size=0 vm_rss=0 vm_swap=0 </span><br><span class="line">11548 14:19:40.970330354 0 sshd (987) &gt; select </span><br><span class="line">11549 14:19:40.970330796 2 sysdig (4466) &gt; switch next=136 pgft_maj=0 pgft_min=1893 vm_size=174596 vm_rss=11472 vm_swap=0 </span><br><span class="line">11550 14:19:40.970331781 2 &lt;NA&gt; (136) &gt; switch next=4466(sysdig) pgft_maj=0 pgft_min=0 vm_size=0 vm_rss=0 vm_swap=0 </span><br><span class="line">11551 14:19:40.970331966 0 sshd (987) &lt; select res=2 </span><br><span class="line">11553 14:19:40.970333077 0 sshd (987) &gt; rt_sigprocmask</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="比较原来的指令"><a href="#比较原来的指令" class="headerlink" title="比较原来的指令"></a>比较原来的指令</h2><ul>
<li>strace who    sysdig proc.name=who</li>
<li><p>sysdig proc.name=cellapp</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">456887 14:30:33.707997040 5 cellapp (5851) &lt; open fd=-2(ENOENT) name=/home/jhlin/mf/tw2/res/entities/common/cdata/xiang_yin_shop_datamodule.so flags=1(O_RDONLY) mode=0 </span><br><span class="line">456888 14:30:33.707998038 5 cellapp (5851) &gt; open </span><br><span class="line">456889 14:30:33.707998999 5 cellapp (5851) &lt; open fd=-2(ENOENT) name=/home/jhlin/mf/bigworld/res/entities/common/cdata/xiang_yin_shop_datamodule.so flags=1(O_RDONLY) mode=0 </span><br><span class="line">456890 14:30:33.708000166 5 cellapp (5851) &gt; open </span><br><span class="line">456891 14:30:33.708002470 5 cellapp (5851) &lt; open fd=11(&lt;f&gt;/home/jhlin/mf/tw2/res/entities/common/cdata/xiang_yin_shop_data.py) name=/home/jhlin/mf/tw2/res/entities/common/cdata/xiang_yin_shop_data.py flags=1(O_RDONLY) mode=0 </span><br><span class="line">456892 14:30:33.708003755 5 cellapp (5851) &gt; fstat fd=11(&lt;f&gt;/home/jhlin/mf/tw2/res/entities/common/cdata/xiang_yin_shop_data.py) </span><br><span class="line">456893 14:30:33.708004286 5 cellapp (5851) &lt; fstat res=0 </span><br><span class="line">456894 14:30:33.708005567 5 cellapp (5851) &gt; open </span><br><span class="line">456895 14:30:33.708007452 5 cellapp (5851) &lt; open fd=12(&lt;f&gt;/home/jhlin/mf/tw2/res/entities/common/cdata/xiang_yin_shop_data.pyc) name=/home/jhlin/mf/tw2/res/entities/common/cdata/xiang_yin_shop_data.pyc flags=1(O_RDONLY) mode=0 </span><br><span class="line">456896 14:30:33.708008563 5 cellapp (5851) &gt; fstat fd=12(&lt;f&gt;/home/jhlin/mf/tw2/res/entities/common/cdata/xiang_yin_shop_data.pyc) </span><br><span class="line">^C456897 14:30:33.708008858 5 cellapp (5851) &lt; fstat res=0</span><br></pre></td></tr></table></figure>
</li>
<li><p>lsof /var/log/syslog    sysdig -c lsof “fd.name=/var/log/syslog”</p>
</li>
<li>sysdig -c lsof “fd.name=/var/log/syslog”<br>COMMAND             PID     TID     USER    FD      TYPE        NAME<br>rsyslogd            1609    1609    root    2       file        /var/log/syslog<br>in:imuxsock         1609    1610    root    2       file        /var/log/syslog<br>in:imklog           1609    1611    root    2       file        /var/log/syslog<br>rs:main             1609    1612    root    2       file        /var/log/syslog</li>
</ul>
<ul>
<li>tcpdump -i eth0    sysdig fd.ip=192.168.45.95</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1568372 14:35:33.768123566 0 dbmgr (5668) &lt; recvfrom res=-11(EAGAIN) data= tuple=NULL </span><br><span class="line">1569303 14:35:33.768834258 0 cellapp (5851) &gt; recvfrom fd=3(&lt;4u&gt;192.168.45.95:53266-&gt;192.168.45.95:51474) size=1472 </span><br><span class="line">1569305 14:35:33.768840078 0 cellapp (5851) &lt; recvfrom res=15 data=X...[w&gt;=#.. v,7 tuple=192.168.45.95:53266-&gt;192.168.45.95:51474 </span><br><span class="line">1569310 14:35:33.768858036 0 cellapp (5851) &gt; recvfrom fd=3(&lt;4u&gt;192.168.45.95:53266-&gt;192.168.45.95:51474) size=1472</span><br></pre></td></tr></table></figure>
<h2 id="chisels凿子-有内建部分"><a href="#chisels凿子-有内建部分" class="headerlink" title="chisels凿子 有内建部分"></a>chisels凿子 有内建部分</h2><ul>
<li><p>sysdig -cl 查看有什么内容</p>
</li>
<li><p>sysdig –i topprocs_cpu 查询 topprocs_cpu的内容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Category: CPU Usage</span><br><span class="line">-------------------</span><br><span class="line">topprocs_cpu    Top processes by CPU usage</span><br><span class="line"></span><br><span class="line">Show the top process defined by the highest CPU utilization. This chisel is com</span><br><span class="line">patible with containers using the sysdig -pc or -pcontainer argument, otherwise</span><br><span class="line"> no container information will be shown.</span><br></pre></td></tr></table></figure>
</li>
<li><p>sysdig -c topprocs_net 执行topprocs_net</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Bytes               Process             PID                 </span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">357.76KB            cellapp             5993</span><br><span class="line">298.25KB            baseapp             5995</span><br><span class="line">216.51KB            sshd                923</span><br><span class="line">90.71KB             xterm               5949</span><br><span class="line">57.19KB             cellappmgr          5669</span><br><span class="line">45.91KB             cellapp             5851</span><br><span class="line">10.15KB             message_logger      2487</span><br><span class="line">6.56KB              xterm               5763</span><br><span class="line">3.80KB              sshd                987</span><br><span class="line">340B                baseappmgr          5670</span><br><span class="line">65B                 sshd                2578</span><br><span class="line">13B                 node                2581</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="Sysdig-应用实例"><a href="#Sysdig-应用实例" class="headerlink" title="Sysdig 应用实例"></a>Sysdig 应用实例</h2><ul>
<li><a href="https://www.ibm.com/developerworks/cn/linux/1607_caoyq_sysdig/index.html" target="_blank" rel="noopener">https://www.ibm.com/developerworks/cn/linux/1607_caoyq_sysdig/index.html</a></li>
</ul>


                
            </div>

            <!-- Comments -->
            
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    


                </div>
            
        </div>
    </div>
</article>

    <!-- Footer -->
    <hr>

<!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    

                    

                    
                        <li>
                            <a href="https://github.com/nimitzlin" target="_blank">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                    

                    

                    

                    
                </ul>
                <p class="copyright text-muted">&copy; 2019 nimitzlin<br></p>
                <p class="copyright text-muted">Original Theme <a target="_blank" href="http://startbootstrap.com/template-overviews/clean-blog/">Clean Blog</a> from <a href="http://startbootstrap.com/" target="_blank">Start Bootstrap</a></p>
                <p class="copyright text-muted">Adapted for <a target="_blank" href="https://hexo.io/">Hexo</a> by <a href="http://www.codeblocq.com/" target="_blank">Jonathan Klughertz</a></p>
            </div>
        </div>
    </div>
</footer>


    <!-- After footer scripts -->
    
<!-- jQuery -->
<script src="//code.jquery.com/jquery-2.1.4.min.js"></script>

<!-- Bootstrap -->
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>

<!-- Gallery -->
<script src="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.js" type="text/javascript" charset="utf-8"></script>

<!-- Disqus Comments -->



</body>

</html>